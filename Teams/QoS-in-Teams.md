---
title: Calidad de servicio (QoS) en Microsoft Teams
author: rmw2890
ms.author: MyAdvisor
manager: Serdars
ms.date: 02/16/2018
ms.topic: article
ms.service: msteams
description: "Prepare la red de su organización para la calidad de servicio (QoS) en Microsoft Teams."
MS.collection: Strat_MT_TeamsAdmin
ms.openlocfilehash: 61bebd64c7d1478c16e114631b696dee2bf59625
ms.sourcegitcommit: 85105cb4e42ae8eb6e7e76eaf6d4dd5b9568cf41
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 02/19/2018
---
<a name="quality-of-service-qos-in-microsoft-teams"></a><span data-ttu-id="fca45-103">Calidad de servicio (QoS) en Microsoft Teams</span><span class="sxs-lookup"><span data-stu-id="fca45-103">Quality of Service (QoS) in Microsoft Teams</span></span>
==========================================
<span data-ttu-id="fca45-104">Esta guía le ayudará a preparar la red de su organización para la calidad de servicio (QoS) en Teams.</span><span class="sxs-lookup"><span data-stu-id="fca45-104">This guide will help you prepare your organization's network for Quality of Service (QoS) in Teams.</span></span>


<span data-ttu-id="fca45-105">La calidad de servicio (QoS) es un mecanismo que le permite priorizar determinados tipos de tráfico de red.</span><span class="sxs-lookup"><span data-stu-id="fca45-105">Quality of Service (QoS) is a mechanism that lets you prioritize certain types of network traffic.</span></span> <span data-ttu-id="fca45-106">Es importante priorizar el tráfico para servicios de comunicaciones en tiempo real, como Teams, para poder ofrecer una experiencia de usuario de tipo empresarial.</span><span class="sxs-lookup"><span data-stu-id="fca45-106">Prioritizing the traffic for real-time communications services such as Teams is important in order to deliver a business-grade user experience.</span></span> <span data-ttu-id="fca45-107">Para que QoS sea realmente efectiva, se debe configurar una conexión de un extremo a otro que sea capaz de implementar la calidad de servicio (PC, conmutadores de red y enrutadores a la nube), puesto que, si alguna de las partes del recorrido falla al respaldar la QoS, la calidad de toda la llamada se podría ver afectada.</span><span class="sxs-lookup"><span data-stu-id="fca45-107">For QoS to be truly effective, a QoS-capable connection must be configured end-to-end (PC, network switches, and routers to the cloud), because any part in the path that fails to support QoS could degrade the quality of the entire call.</span></span>


![Captura de pantalla de un diagrama donde se ilustra la relación entre las redes de una organización y los servicios de Office 365.](media/Qos-in-Teams-Image1.png)

 

<span data-ttu-id="fca45-109">En la mayoría de los casos, la red de interconexión será una red sin administrar, una conexión de Internet.</span><span class="sxs-lookup"><span data-stu-id="fca45-109">In most cases, the interconnect network will be an unmanaged network, an internet connection.</span></span> <span data-ttu-id="fca45-110">Una opción disponible para abordar la QoS de un extremo a otro es [ExpressRoute](https://azure.microsoft.com/documentation/articles/expressroute-introduction/).</span><span class="sxs-lookup"><span data-stu-id="fca45-110">One option available to address end-to-end QoS is [ExpressRoute](https://azure.microsoft.com/documentation/articles/expressroute-introduction/).</span></span> <span data-ttu-id="fca45-111">Nuestra recomendación sigue siendo implementar QoS en las partes de la red que usted controle, concretamente en su red local.</span><span class="sxs-lookup"><span data-stu-id="fca45-111">It is our recommendation to still implement QoS on the portions of the network you have control over, namely your on-premises network.</span></span> <span data-ttu-id="fca45-112">De este modo se incrementa la calidad de las cargas de trabajo de comunicación en tiempo real a través de la implementación y se mitigan los puntos de contención de su implementación actual.</span><span class="sxs-lookup"><span data-stu-id="fca45-112">This will increase the quality of real time communication workloads throughout your deployment and will alleviate choke points in your existing deployment.</span></span> 

## <a name="objectives"></a><span data-ttu-id="fca45-113">Objetivos</span><span class="sxs-lookup"><span data-stu-id="fca45-113">Objectives</span></span> 

<span data-ttu-id="fca45-114">Esta guía se centra en cómo se prioriza el tráfico de comunicaciones en tiempo real de Teams, principalmente voz y vídeo.</span><span class="sxs-lookup"><span data-stu-id="fca45-114">This guide will focus on how to prioritize Teams real-time communications traffic, namely voice and video.</span></span> <span data-ttu-id="fca45-115">También se pueden priorizar otros tipos de tráfico en función de sus necesidades.</span><span class="sxs-lookup"><span data-stu-id="fca45-115">Other types of traffic can also be prioritized based on your needs.</span></span>

<span data-ttu-id="fca45-116">Existen diversos métodos para priorizar el tráfico, pero el más común consiste en usar marcados de punto de código de servicios diferenciados (DSCP).</span><span class="sxs-lookup"><span data-stu-id="fca45-116">There are multiple ways to prioritize traffic, but the most common is by using differentiated services code point (DSCP) markings.</span></span> <span data-ttu-id="fca45-117">Se pueden aplicar en función de los intervalos de puertos, pero también a través de objetos de directiva de grupo.</span><span class="sxs-lookup"><span data-stu-id="fca45-117">They can be applied based on port ranges but also via Group Policy objects.</span></span> <span data-ttu-id="fca45-118">Se cubrirán ambos métodos en este documento.</span><span class="sxs-lookup"><span data-stu-id="fca45-118">We will cover both in this document.</span></span>

<span data-ttu-id="fca45-119">Al controlar el marcado de DSCP a través de los objetos de directiva grupo (GPO) se garantiza que los equipos unidos a un dominio reciban la configuración correcta y que esos ajustes solo los pueda gestionar un administrador.</span><span class="sxs-lookup"><span data-stu-id="fca45-119">Controlling the DSCP marking via Group Policy objects (GPO) ensures that domain-joined computers receive the correct settings and that these settings can only be managed by an administrator.</span></span> 

<span data-ttu-id="fca45-120">Es importante saber que QoS solo funciona cuando se implementa en todos los vínculos que conectan a la persona que llama con el destinatario.</span><span class="sxs-lookup"><span data-stu-id="fca45-120">It’s important to understand that QoS only works when implemented on all links connecting caller to callee.</span></span> <span data-ttu-id="fca45-121">Si usamos QoS en la red interna y un usuario inicia sesión desde una ubicación remota, solo se podrá priorizar dentro de nuestra red interna y administrada.</span><span class="sxs-lookup"><span data-stu-id="fca45-121">If we use QoS on the internal network and a user signs in from a remote location, we can only prioritize within our internal, managed, network.</span></span> <span data-ttu-id="fca45-122">Si bien las ubicaciones remotas podrían recibir una conexión administrada al implementar una VPN, no se recomienda ejecutar tráfico de comunicaciones en tiempo real a través de la VPN.</span><span class="sxs-lookup"><span data-stu-id="fca45-122">While remote locations could receive a managed connection by implementing a VPN, it is not recommended to run real-time communications traffic over the VPN.</span></span>

> [!NOTE]
> <span data-ttu-id="fca45-123">Nuestra recomendación es implementar la tunelización dividida para usuarios remotos conectados por VPN para lograr la mejor experiencia posible del usuario.</span><span class="sxs-lookup"><span data-stu-id="fca45-123">Our recommendation is to implement split tunneling for VPN connected remote users to maximize the user experience.</span></span> <span data-ttu-id="fca45-124">Consulte el documento [Implementar-Guía-Túnel dividido de VPN](https://myadvisor.fasttrack.microsoft.com/CloudVoice/Downloads?SelectedIDs=5_1_0_9 ) para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="fca45-124">See the document [Deploy-Guidance-VPN Split Tunnel](https://myadvisor.fasttrack.microsoft.com/CloudVoice/Downloads?SelectedIDs=5_1_0_9 ) for more information.</span></span>

<span data-ttu-id="fca45-125">En una organización global con vínculos administrados que abarcan continentes, se recomienda encarecidamente utilizar QoS, puesto que el ancho de banda es limitado en comparación con la red local (LAN).</span><span class="sxs-lookup"><span data-stu-id="fca45-125">In a global organization with managed links spanning continents, QoS is highly recommended since the bandwidth is limited in comparisons to the local network (LAN).</span></span>

## <a name="quality-of-service"></a><span data-ttu-id="fca45-126">Calidad de servicio</span><span class="sxs-lookup"><span data-stu-id="fca45-126">Managing Quality of Service</span></span>

<span data-ttu-id="fca45-127">Para poder proporcionar un nivel de servicio garantizado para una aplicación de la red, los dispositivos de red subyacentes deben tener una forma de poder clasificar los diferentes tipos de tráfico.</span><span class="sxs-lookup"><span data-stu-id="fca45-127">In order to provide a guaranteed level of service for an application on the network, the underlying network devices must have a way to classify different types of traffic.</span></span> <span data-ttu-id="fca45-128">Un enrutador, por ejemplo, debe poder distinguir entre tráfico de voz y tráfico de navegador web normal, si se espera que la voz reciba un mejor tratamiento.</span><span class="sxs-lookup"><span data-stu-id="fca45-128">A router, for example, must be able to distinguish between voice traffic and normal web browsing traffic, if there is an expectation that voice receives better treatment.</span></span> 

<span data-ttu-id="fca45-129">Los servicios diferenciados (DiffServ) proporcionan un marco en el que los dispositivos de red manejan el tráfico con prioridades que se basan en el campo del tipo de servicios (ToS) del encabezado de un paquete IPv4/IPv6.</span><span class="sxs-lookup"><span data-stu-id="fca45-129">Differentiated Services (DiffServ) provides a framework in which traffic is treated by network devices with priorities based on the type of services (ToS) field in the header of an IPv4/IPv6 packet.</span></span> <span data-ttu-id="fca45-130">Los seis bits más significativos del campo DiffServ se conocen como el punto de código de servicios diferenciados o DSCP.</span><span class="sxs-lookup"><span data-stu-id="fca45-130">The six most significant bits of the DiffServ field is known as the Differentiated Services Code Point, or DSCP.</span></span> <span data-ttu-id="fca45-131">Con este marco, el tráfico se puede clasificar como un tipo particular de tráfico (voz) y después marcarse (101110 o 46 en decimal), de manera que cuando los dispositivos de red procesan estos marcados, el tráfico se puede priorizar en consecuencia (desvío rápido, en este ejemplo).</span><span class="sxs-lookup"><span data-stu-id="fca45-131">Using this framework, traffic can be classified as a particular type of traffic (voice), and then marked (101110, or 46 in decimal), such that when network devices process these markings, the traffic can be prioritized accordingly (Expedited Forwarding, in this example).</span></span>

<span data-ttu-id="fca45-132">Cuando el tráfico de red pasa por un enrutador, el tráfico se sitúa en una cola. En caso de no haber QoS implementado, básicamente existe solo una cola y los datos se tratan con el principio de que el primero en entrar es el primero en salir. Eso significa que el tráfico de voz (donde es probable que se produzcan retrasos) podría quedarse detenido detrás del tráfico de los servicios de transmisión en línea.</span><span class="sxs-lookup"><span data-stu-id="fca45-132">When network traffic enters a router, the traffic is placed into a queue – if there is no QoS in place, essentially there is only one queue, and data is treated as first-in, first-out. That means voice traffic (which is very sensitive to delays) could get stuck behind traffic from online streaming services.</span></span> <span data-ttu-id="fca45-133">Cuando se implementa QoS, se pueden definir varias colas con distintas características para administrar la congestión (como la cola de prioridades de Cisco ["Priority Queuing", PQ] y la cola de espera equitativa y ponderada basada en clases ["Class Based Weighted Fair Queue", CBWFQ]) y características para evitar la congestión (como la detección anticipada aleatoria ponderada ["Weighted Random Early Detection", WRED]).</span><span class="sxs-lookup"><span data-stu-id="fca45-133">When implementing QoS, multiple queues can be defined, with different congestion management features (such as Cisco’s Priority Queuing (PQ) and Class Based Weighted Fair Queue (CBWFQ)) and congestion avoidance features (such as Weighted Random Early Detection (WRED)).</span></span>

![Captura de pantalla de un diagrama donde se ilustran las colas de QoS en Teams.](media/Qos-in-Teams-Image2.png)

<span data-ttu-id="fca45-135">Figura 1: Colas de QoS visualizadas</span><span class="sxs-lookup"><span data-stu-id="fca45-135">Figure 1: QoS queues visualized</span></span>

<span data-ttu-id="fca45-136">Una vez que todas estas piezas están colocadas en su sitio, se puede ofrecer un nivel de calidad de servicio predecible, ya que la red administrada subyacente sabe cómo hay que clasificar, marcar y priorizar el tráfico.</span><span class="sxs-lookup"><span data-stu-id="fca45-136">Once these pieces are in place, a predictable quality of service can be delivered, as the underlying managed network now understands how to classify, mark and prioritize traffic.</span></span> <span data-ttu-id="fca45-137">Desde la perspectiva de Teams, el elemento más importante de la configuración es la clasificación y el marcado de los paquetes, si bien también hay que realizar una cuidadosa planificación para poder alinear la configuración de la aplicación con la configuración de red subyacente y que el QoS de un extremo a otro se realice correctamente.</span><span class="sxs-lookup"><span data-stu-id="fca45-137">From the Teams perspective, the most important configuration item is the classification and marking of packets – but careful planning is involved to align the application’s configuration with the underlying network configuration for end-to-end QoS to be successful.</span></span>

## <a name="qos-scenarios"></a><span data-ttu-id="fca45-138">Escenarios de QoS</span><span class="sxs-lookup"><span data-stu-id="fca45-138">QoS scenarios</span></span>

<span data-ttu-id="fca45-139">A la hora de implementar QoS para Teams, hemos basado nuestras instrucciones en cuatro escenarios de partida:</span><span class="sxs-lookup"><span data-stu-id="fca45-139">When implementing QoS for Teams, we’ve based our guidance on four starting scenarios:</span></span>

1.  <span data-ttu-id="fca45-140">Ha implementado o está implementando Teams y tiene pensado implementar QoS a través del etiquetado basado en puertos.</span><span class="sxs-lookup"><span data-stu-id="fca45-140">You’ve deployed or are deploying Teams and are planning on implementing QoS via Port Based Tagging.</span></span> <span data-ttu-id="fca45-141">El etiquetado basado en puertos es el método más fiable, puesto que funciona de manera universal en todas las plataformas y es el más fácil de implementar.</span><span class="sxs-lookup"><span data-stu-id="fca45-141">Port Based Tagging is the most reliable method since it works universally throughout all platforms and is the easiest to implement.</span></span> 

2.  <span data-ttu-id="fca45-142">Ha implementado o está implementando Teams y tiene pensado implementar QoS a través del etiquetado de objetos de directiva de grupo.</span><span class="sxs-lookup"><span data-stu-id="fca45-142">You’ve deployed or are deploying Teams and are planning to implement QoS via Group Policy Object tagging.</span></span> <span data-ttu-id="fca45-143">Este método se usa en ocasiones en combinación con el escenario 1.</span><span class="sxs-lookup"><span data-stu-id="fca45-143">This is sometimes used in combination with scenario 1.</span></span> <span data-ttu-id="fca45-144">Si bien este escenario es completamente válido y se describe más adelante, es importante saber que solo funcionará para clientes Windows unidos a un dominio.</span><span class="sxs-lookup"><span data-stu-id="fca45-144">While this scenario is entirely valid and described below, it is important to understand this will only work for Domain Joined Windows Clients.</span></span> <span data-ttu-id="fca45-145">Cualquier otro dispositivo que no sea un cliente Windows unido a un dominio no se habilitará para el etiquetado QoS/DSCP.</span><span class="sxs-lookup"><span data-stu-id="fca45-145">Any device that is not a Windows Domain Joined Client will not be enabled for QoS\DSCP Tagging.</span></span> 

3.  <span data-ttu-id="fca45-146">Ha implementado Skype Empresarial Online con el etiquetado QoS y ahora está implementando Teams.</span><span class="sxs-lookup"><span data-stu-id="fca45-146">You have Skype for Business Online deployed including QoS Tagging and are now deploying Teams.</span></span> <span data-ttu-id="fca45-147">Si ese es su caso, Teams respetará la configuración existente y usará los mismos intervalos de puertos y el mismo etiquetado que el cliente de Skype Empresarial.</span><span class="sxs-lookup"><span data-stu-id="fca45-147">If this is you, Teams will respect the existing configuration and will use the same port ranges and tagging as the Skype for Business client.</span></span> <span data-ttu-id="fca45-148">No será necesario utilizar ninguna otra configuración adicional.</span><span class="sxs-lookup"><span data-stu-id="fca45-148">No additional configuration should be needed.</span></span> 
    > [!NOTE]
    > <span data-ttu-id="fca45-149">Si está usando el etiquetado QoS de nombre de aplicación a través de la directiva de grupo, debería agregar “Teams.exe” como el nombre de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="fca45-149">If you're using Application Name QoS tagging via Group Policy you should add “Teams.exe” as Application Name.</span></span>
4.  <span data-ttu-id="fca45-150">Ha implementado Teams o lo está implementando y quiere implementar QoS a través del etiquetado basado en puertos con un intervalo de puertos personalizado.</span><span class="sxs-lookup"><span data-stu-id="fca45-150">You’ve deployed or are deploying Teams and want to implement QoS via port-based tagging with a custom port range.</span></span>

## <a name="recommended-differentiated-services-code-point-dscp-markings"></a><span data-ttu-id="fca45-151">Marcados de punto de código de servicios diferenciados (DSCP) recomendados</span><span class="sxs-lookup"><span data-stu-id="fca45-151">Recommended differentiated services code point (DSCP) markings</span></span>

<span data-ttu-id="fca45-152">El primer paso consiste en clasificar los flujos de tráfico (como el audio y el vídeo) evaluando los intervalos de puertos únicos no superpuestos con un valor de DSCP.</span><span class="sxs-lookup"><span data-stu-id="fca45-152">The first step is to classify the traffic flows (such as audio and video) by leveraging the unique, non-overlapping port ranges with a DSCP-value.</span></span> <span data-ttu-id="fca45-153">El valor de DSCP que se asigne aquí determinará la prioridad del tráfico que pasará por la red (en función de la configuración de red).</span><span class="sxs-lookup"><span data-stu-id="fca45-153">The DSCP value assigned here will determine the priority of the traffic going through the network (based on the network configuration).</span></span> <span data-ttu-id="fca45-154">Cada carga de trabajo obtiene su propio valor de DSCP, aunque algunos clientes podrían establecer el mismo valor para la voz y el vídeo, otorgándoles de este modo la misma prioridad en la red.</span><span class="sxs-lookup"><span data-stu-id="fca45-154">Each workload gets its own DSCP value, although some customers might set the same value on voice and video, giving them the same priority in the network.</span></span> 

<span data-ttu-id="fca45-155">El valor de DSCP que se use dependerá de la prioridad que se dé a cada carga de trabajo.</span><span class="sxs-lookup"><span data-stu-id="fca45-155">What DSCP value to use depends on how a workload is prioritized.</span></span> <span data-ttu-id="fca45-156">Por ejemplo, los requisitos empresariales podrían dictar que el uso compartido de aplicaciones se trate con el mismo nivel de prioridad que el vídeo (y, por lo tanto, se marque con el mismo valor de DSCP que el del vídeo).</span><span class="sxs-lookup"><span data-stu-id="fca45-156">For example, business requirements could dictate that application sharing is to be treated with the same level of priority as video (and as such, marked with the same DSCP-value as video).</span></span> <span data-ttu-id="fca45-157">Otros entornos podrían ya contar con una estrategia de QoS.</span><span class="sxs-lookup"><span data-stu-id="fca45-157">Other environments might have an existing QoS strategy in place already.</span></span> 

<span data-ttu-id="fca45-158">En la tabla 1 siguiente se muestran los marcados de DSCP que se requieren cuando se utiliza Teams con ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="fca45-158">Table 1 below shows the required DSCP markings when utilizing Teams with ExpressRoute.</span></span> <span data-ttu-id="fca45-159">Podría servir como un buen punto de partida para clientes que no tienen claro qué deben usar en su propio entorno.</span><span class="sxs-lookup"><span data-stu-id="fca45-159">This could serve as a good starting point for customers unsure what to use in their own environment.</span></span> <span data-ttu-id="fca45-160">Para obtener más información, lea [Requisitos de QoS ExpressRoute](https://docs.microsoft.com/azure/expressroute/expressroute-qos).</span><span class="sxs-lookup"><span data-stu-id="fca45-160">To learn more, read [ExpressRoute QoS requirements](https://docs.microsoft.com/azure/expressroute/expressroute-qos).</span></span>


| <span data-ttu-id="fca45-161">Puerto origen del cliente</span><span class="sxs-lookup"><span data-stu-id="fca45-161">Client source port</span></span>|<span data-ttu-id="fca45-162">Protocolo</span><span class="sxs-lookup"><span data-stu-id="fca45-162">Protocol</span></span>|<span data-ttu-id="fca45-163">Categoría del medio</span><span class="sxs-lookup"><span data-stu-id="fca45-163">Media category</span></span>|<span data-ttu-id="fca45-164">Valor de DSCP común</span><span class="sxs-lookup"><span data-stu-id="fca45-164">Common DSCP value</span></span>|<span data-ttu-id="fca45-165">Clase de DSCP</span><span class="sxs-lookup"><span data-stu-id="fca45-165">DSCP class</span></span>|
|---------|---------|---------|---------|---------|
| <span data-ttu-id="fca45-166">50 000 – 50 019</span><span class="sxs-lookup"><span data-stu-id="fca45-166">50,000 – 50,019</span></span>|<span data-ttu-id="fca45-167">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="fca45-167">TCP/UDP</span></span>|<span data-ttu-id="fca45-168">Audio</span><span class="sxs-lookup"><span data-stu-id="fca45-168">Audio</span></span>|<span data-ttu-id="fca45-169">46</span><span class="sxs-lookup"><span data-stu-id="fca45-169">46</span></span>|<span data-ttu-id="fca45-170">Desvío rápido (EF)</span><span class="sxs-lookup"><span data-stu-id="fca45-170">Expedited Forwarding (EF)</span></span>|
| <span data-ttu-id="fca45-171">50 020 – 50 039</span><span class="sxs-lookup"><span data-stu-id="fca45-171">50,020 – 50,039</span></span>|<span data-ttu-id="fca45-172">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="fca45-172">TCP/UDP</span></span>|<span data-ttu-id="fca45-173">Vídeo</span><span class="sxs-lookup"><span data-stu-id="fca45-173">Video</span></span>|<span data-ttu-id="fca45-174">34</span><span class="sxs-lookup"><span data-stu-id="fca45-174">3-4</span></span>|<span data-ttu-id="fca45-175">Desvío garantizado (AF41)</span><span class="sxs-lookup"><span data-stu-id="fca45-175">Assured Forwarding (AF41)</span></span>|
| <span data-ttu-id="fca45-176">50 040 – 50 059</span><span class="sxs-lookup"><span data-stu-id="fca45-176">50,040 – 50,059</span></span>|<span data-ttu-id="fca45-177">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="fca45-177">TCP/UDP</span></span>|<span data-ttu-id="fca45-178">Compartir aplicaciones/escritorio y transferencia de archivos</span><span class="sxs-lookup"><span data-stu-id="fca45-178">Application/Desktop Sharing and File Transfer</span></span>|<span data-ttu-id="fca45-179">18</span><span class="sxs-lookup"><span data-stu-id="fca45-179">18</span></span>|<span data-ttu-id="fca45-180">Selector de clases (CS3)</span><span class="sxs-lookup"><span data-stu-id="fca45-180">Class Selector (CS3)</span></span>|

<span data-ttu-id="fca45-181">Tabla 1: Marcados de DSCP</span><span class="sxs-lookup"><span data-stu-id="fca45-181">Table 1: DSCP markings</span></span>

<span data-ttu-id="fca45-182">Hay que tener en cuenta algunas cosas cuando se use la información de la tabla 1:</span><span class="sxs-lookup"><span data-stu-id="fca45-182">Here are some caveats to understand when you use the information in Table 1:</span></span>

- <span data-ttu-id="fca45-183">El uso compartido de archivos y el uso compartido de aplicaciones emplean el mismo intervalo de puertos de origen y, por lo tanto, usarían los mismos marcados de DSCP cuando se utilice el etiquetado basado en puertos.</span><span class="sxs-lookup"><span data-stu-id="fca45-183">File sharing and application sharing use the same source port range – and as such, would use the same DSCP markings when using Port Based Tagging.</span></span> <span data-ttu-id="fca45-184">Por este motivo, se debería determinar qué prioridad habría que aplicar mayormente a *ambas* modalidades (interactiva o predeterminada).</span><span class="sxs-lookup"><span data-stu-id="fca45-184">Because of this, it should be determined which priority is most applicable to *both* modalities (Interactive or Default).</span></span>
    
- <span data-ttu-id="fca45-185">Si hay un plan para implementar ExpressRoute en el futuro y QoS no se ha implementado todavía, lo más recomendable es seguir las indicaciones anteriores para que los valores de DSCP sean los mismos del remitente para el receptor.</span><span class="sxs-lookup"><span data-stu-id="fca45-185">If there’s a plan to implement ExpressRoute in the future and QoS has not yet been implemented, the recommendation is to follow the guidance given above so that DSCP values are the same from sender to receiver.</span></span> 
    
## <a name="source-ports-used-by-teams"></a><span data-ttu-id="fca45-186">Puertos de origen que usa Teams</span><span class="sxs-lookup"><span data-stu-id="fca45-186">Source ports used by Teams</span></span>

<span data-ttu-id="fca45-187">En Teams, QoS se debe configurar en función de los puertos de origen que utilizan las diferentes cargas de trabajo.</span><span class="sxs-lookup"><span data-stu-id="fca45-187">In Teams, QoS should be configured based on the source ports used by the different workloads.</span></span> <span data-ttu-id="fca45-188">Los intervalos de puertos del servidor y los del cliente no son configurables en este punto.</span><span class="sxs-lookup"><span data-stu-id="fca45-188">Both server-side and client-side port ranges are non-configurable at this point.</span></span> 

<span data-ttu-id="fca45-189">Para implementar QoS, use los intervalos de puertos de origen del cliente que se enumeran en la tabla 2, con los marcados de DSCP del QoS asociados.</span><span class="sxs-lookup"><span data-stu-id="fca45-189">To deploy QoS, use the client source port ranges listed in Table 2, with their associated QoS DSCP markings.</span></span>

| <span data-ttu-id="fca45-190">Puerto origen del cliente</span><span class="sxs-lookup"><span data-stu-id="fca45-190">Client source port</span></span>|<span data-ttu-id="fca45-191">Protocolo</span><span class="sxs-lookup"><span data-stu-id="fca45-191">Protocol</span></span>|<span data-ttu-id="fca45-192">Categoría del medio</span><span class="sxs-lookup"><span data-stu-id="fca45-192">Media category</span></span>|<span data-ttu-id="fca45-193">Valor de DSCP común</span><span class="sxs-lookup"><span data-stu-id="fca45-193">Common DSCP value</span></span>|<span data-ttu-id="fca45-194">Clase de DSCP</span><span class="sxs-lookup"><span data-stu-id="fca45-194">DSCP class</span></span>|
|---------|---------|---------|---------|---------|
| <span data-ttu-id="fca45-195">50 000 – 50 019</span><span class="sxs-lookup"><span data-stu-id="fca45-195">50,000 – 50,019</span></span>|<span data-ttu-id="fca45-196">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="fca45-196">TCP/UDP</span></span>|<span data-ttu-id="fca45-197">Audio</span><span class="sxs-lookup"><span data-stu-id="fca45-197">Audio</span></span>|<span data-ttu-id="fca45-198">46</span><span class="sxs-lookup"><span data-stu-id="fca45-198">46</span></span>|<span data-ttu-id="fca45-199">Desvío rápido (EF)</span><span class="sxs-lookup"><span data-stu-id="fca45-199">Expedited Forwarding (EF)</span></span>|
| <span data-ttu-id="fca45-200">50 020 – 50 039</span><span class="sxs-lookup"><span data-stu-id="fca45-200">50,020 – 50,039</span></span>|<span data-ttu-id="fca45-201">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="fca45-201">TCP/UDP</span></span>|<span data-ttu-id="fca45-202">Vídeo</span><span class="sxs-lookup"><span data-stu-id="fca45-202">Video</span></span>|<span data-ttu-id="fca45-203">34</span><span class="sxs-lookup"><span data-stu-id="fca45-203">3-4</span></span>|<span data-ttu-id="fca45-204">Desvío garantizado (AF41)</span><span class="sxs-lookup"><span data-stu-id="fca45-204">Assured Forwarding (AF41)</span></span>|
| <span data-ttu-id="fca45-205">50 040 – 50 059</span><span class="sxs-lookup"><span data-stu-id="fca45-205">50,040 – 50,059</span></span>|<span data-ttu-id="fca45-206">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="fca45-206">TCP/UDP</span></span>|<span data-ttu-id="fca45-207">Compartir aplicaciones/escritorio y transferencia de archivos</span><span class="sxs-lookup"><span data-stu-id="fca45-207">Application/Desktop Sharing and File Transfer</span></span>|<span data-ttu-id="fca45-208">18</span><span class="sxs-lookup"><span data-stu-id="fca45-208">18</span></span>|<span data-ttu-id="fca45-209">Selector de clases (CS3)</span><span class="sxs-lookup"><span data-stu-id="fca45-209">Class Selector (CS3)</span></span>|

<span data-ttu-id="fca45-210">Tabla 2: Intervalos de puertos de origen del cliente</span><span class="sxs-lookup"><span data-stu-id="fca45-210">Table 2: Client source port ranges</span></span>

> [!NOTE]
> <span data-ttu-id="fca45-211">Si ya ha configurado QoS en función de los intervalos de puertos de origen para Skype Empresarial Online, se aplicará la misma configuración en Teams sin que haga falta ningún otro cambio.</span><span class="sxs-lookup"><span data-stu-id="fca45-211">If you've already configured QoS based on source port ranges for Skype for Business Online, the same configuration will apply to Teams and no further changes are required.</span></span> <span data-ttu-id="fca45-212">Si ya ha implementado Skype Empresarial Server (en local), tendrá que volver a diseñar sus directivas de QoS.</span><span class="sxs-lookup"><span data-stu-id="fca45-212">If you’ve deployed Skype for Business Server (on premises), you will need to redesign your QoS Policies.</span></span>

## <a name="setting-differentiated-services-code-point-dscp-markings"></a><span data-ttu-id="fca45-213">Configuración de marcados de punto de código de servicios diferenciados (DSCP)</span><span class="sxs-lookup"><span data-stu-id="fca45-213">Setting differentiated services code point (DSCP) markings</span></span>

<span data-ttu-id="fca45-214">Hay muchas formas de configurar los marcados de DSCP adecuados para llevar a cabo la clasificación del tráfico.</span><span class="sxs-lookup"><span data-stu-id="fca45-214">There are multiple approaches to setting the proper DSCP markings for traffic classification.</span></span>

- <span data-ttu-id="fca45-215">El marcado de DSCP en el punto de conexión: esta es la opción que se prefiere en general, ya que el mismo punto de conexión proporciona los marcados adecuados.</span><span class="sxs-lookup"><span data-stu-id="fca45-215">DSCP marking at the endpoint: This is the preferred option in general, as the endpoint itself is providing the proper markings.</span></span> <span data-ttu-id="fca45-216">En este momento esto se podría conseguir con un GPO, pero solo es posible en clientes Windows unidos a un dominio.</span><span class="sxs-lookup"><span data-stu-id="fca45-216">Currently this could be done by using a GPO, but this is only possible on domain-joined Windows clients.</span></span> <span data-ttu-id="fca45-217">Los clientes móviles o Mac OSX, por ejemplo, no proporcionan un mecanismo que pueda marcar el tráfico con valores de DSCP.</span><span class="sxs-lookup"><span data-stu-id="fca45-217">Mac OSX or mobile clients, for example, do not provide a mechanism to mark traffic with DSCP values.</span></span>

- <span data-ttu-id="fca45-218">Basado en puertos con listas ACL en enrutadores: es una opción muy común en entornos heterogéneos de Windows y Mac.</span><span class="sxs-lookup"><span data-stu-id="fca45-218">Port-based using ACLs on routers: This is a very common option encountered in heterogeneous environments of Windows and Mac.</span></span> <span data-ttu-id="fca45-219">En este escenario, el equipo de red marca el tráfico en los enrutadores de entrada/salida (normalmente en la red de área extensa [WAN]) en función de los intervalos de puertos de origen definidos para cada modalidad.</span><span class="sxs-lookup"><span data-stu-id="fca45-219">In this scenario, the network team marks the traffic at the ingress/egress routers (typically on the Wide Area Network (WAN)) based on the source port ranges defined for each modality.</span></span> <span data-ttu-id="fca45-220">Si bien esto funciona en todas las plataformas, solo marca en el extremo WAN (no en todo el trayecto hasta el equipo cliente) e incurre en sobrecarga de administración.</span><span class="sxs-lookup"><span data-stu-id="fca45-220">While this works across platforms, it only marks at the WAN edge – not all the way to the client machine – and incurs management overhead.</span></span>
    
- <span data-ttu-id="fca45-221">Una combinación de marcados de DSCP en el cliente y listas ACL basadas en puertos en los enrutadores.</span><span class="sxs-lookup"><span data-stu-id="fca45-221">A combination of DSCP markings on the client and port-based ACLs on routers.</span></span>
    
<span data-ttu-id="fca45-222">Si es posible, se recomienda una combinación de ambos y, de ese modo, usar un GPO para filtrar la mayoría de clientes y usar también el etiquetado DSCP basado en puertos para garantizar que los clientes móviles, los Mac y otros clientes seguirán obteniendo una tratamiento de QoS (parcial).</span><span class="sxs-lookup"><span data-stu-id="fca45-222">If possible, we recommend a combination of both, to use a GPO to catch the majority of clients, and to also use port based DSCP tagging to ensure mobile clients, Mac and other clients will still get a (partial) QoS treatment.</span></span>

<span data-ttu-id="fca45-223">Para configurar el valor de DSCP para el intervalo de puertos de origen predefinido en el cliente de Teams, se puede usar QoS basado en directivas dentro de la directiva de grupo.</span><span class="sxs-lookup"><span data-stu-id="fca45-223">Setting the DSCP value for the pre-defined source port range in the Teams client can be done using policy-based QoS within Group Policy.</span></span> <span data-ttu-id="fca45-224">En la siguiente tabla se usan los intervalos de puertos especificados en la tabla para crear una directiva para cada carga de trabajo.</span><span class="sxs-lookup"><span data-stu-id="fca45-224">The following table uses the port ranges specified in the table to create a policy for each workload.</span></span>

| <span data-ttu-id="fca45-225">Tipo de tráfico del cliente</span><span class="sxs-lookup"><span data-stu-id="fca45-225">Client traffic type</span></span>|<span data-ttu-id="fca45-226">Inicio del intervalo de puertos</span><span class="sxs-lookup"><span data-stu-id="fca45-226">Port range start</span></span>|<span data-ttu-id="fca45-227">Fin del intervalo de puertos</span><span class="sxs-lookup"><span data-stu-id="fca45-227">Port range end</span></span>|<span data-ttu-id="fca45-228">Valor de DSCP</span><span class="sxs-lookup"><span data-stu-id="fca45-228">DSCP value</span></span>|
|---------|---------|---------|--------|
| <span data-ttu-id="fca45-229">Audio</span><span class="sxs-lookup"><span data-stu-id="fca45-229">Audio</span></span>|<span data-ttu-id="fca45-230">50000</span><span class="sxs-lookup"><span data-stu-id="fca45-230">50000</span></span>|<span data-ttu-id="fca45-231">50019</span><span class="sxs-lookup"><span data-stu-id="fca45-231">50019</span></span>|<span data-ttu-id="fca45-232">46</span><span class="sxs-lookup"><span data-stu-id="fca45-232">46</span></span>|
| <span data-ttu-id="fca45-233">Vídeo</span><span class="sxs-lookup"><span data-stu-id="fca45-233">Video</span></span>|<span data-ttu-id="fca45-234">50020</span><span class="sxs-lookup"><span data-stu-id="fca45-234">50020</span></span>|<span data-ttu-id="fca45-235">50039</span><span class="sxs-lookup"><span data-stu-id="fca45-235">50039</span></span>|<span data-ttu-id="fca45-236">34</span><span class="sxs-lookup"><span data-stu-id="fca45-236">3-4</span></span>|
| <span data-ttu-id="fca45-237">Uso compartido de aplicaciones</span><span class="sxs-lookup"><span data-stu-id="fca45-237">Application sharing</span></span>|<span data-ttu-id="fca45-238">50040</span><span class="sxs-lookup"><span data-stu-id="fca45-238">50040</span></span>|<span data-ttu-id="fca45-239">50059</span><span class="sxs-lookup"><span data-stu-id="fca45-239">50059</span></span>|<span data-ttu-id="fca45-240">18</span><span class="sxs-lookup"><span data-stu-id="fca45-240">18</span></span>|
| <span data-ttu-id="fca45-241">Transferencia de archivos</span><span class="sxs-lookup"><span data-stu-id="fca45-241">File transfer</span></span>|<span data-ttu-id="fca45-242">50040</span><span class="sxs-lookup"><span data-stu-id="fca45-242">50040</span></span>|<span data-ttu-id="fca45-243">50059</span><span class="sxs-lookup"><span data-stu-id="fca45-243">50059</span></span>|<span data-ttu-id="fca45-244">18</span><span class="sxs-lookup"><span data-stu-id="fca45-244">18</span></span>|

<span data-ttu-id="fca45-245">Tabla 3: Intervalos de puertos según el tipo de tráfico</span><span class="sxs-lookup"><span data-stu-id="fca45-245">Table 3: Port ranges by traffic type</span></span>

<span data-ttu-id="fca45-246">Nota: Los intervalos de puertos que establece Teams no se pueden modificar ni alterar.</span><span class="sxs-lookup"><span data-stu-id="fca45-246">Note: The port ranges set by Teams cannot be changed or altered.</span></span> <span data-ttu-id="fca45-247">Revisa esta página para ver la última información al respecto: https://support.microsoft.com/kb/2409256</span><span class="sxs-lookup"><span data-stu-id="fca45-247">Please review this page for the latest information: https://support.microsoft.com/ kb/2409256</span></span>

<span data-ttu-id="fca45-248">Una vez que los intervalos de puertos se han determinado, el siguiente paso consiste en configurar las opciones de QoS basado en directivas dentro de un objeto de directiva de grupo (GPO).</span><span class="sxs-lookup"><span data-stu-id="fca45-248">Once the port ranges have been determined, the next step is to configure the policy-based QoS settings within a Group Policy Object (GPO).</span></span> <span data-ttu-id="fca45-249">Los detalles de los pasos siguientes se pueden encontrar en [TechNet](https://technet.microsoft.com/library/jj205371(v=ocs.15).aspx).</span><span class="sxs-lookup"><span data-stu-id="fca45-249">Details for these steps can be found on [TechNet](https://technet.microsoft.com/library/jj205371(v=ocs.15).aspx).</span></span> 

<span data-ttu-id="fca45-250">Las nuevas directivas que ha creado no surtirán efecto hasta que la directiva de grupo se haya actualizado en los equipos cliente.</span><span class="sxs-lookup"><span data-stu-id="fca45-250">The new policies you have created won’t take effect until Group Policy has been refreshed on your client computers.</span></span> <span data-ttu-id="fca45-251">Aunque la directiva de grupo se actualiza periódicamente por sí misma, se puede forzar una actualización inmediata si se ejecuta el siguiente comando en cada equipo en el que se tenga que actualizar la directiva de grupo:</span><span class="sxs-lookup"><span data-stu-id="fca45-251">Although Group Policy periodically refreshes on its own, you can force an immediate refresh by running the following command on each computer where Group Policy needs to be refreshed:</span></span>

        gpudate.exe /force

<span data-ttu-id="fca45-252">Este comando se puede ejecutar desde cualquier ventana de comandos que se ejecute con las credenciales del administrador.</span><span class="sxs-lookup"><span data-stu-id="fca45-252">This command can be run from any command window that is running under administrator credentials.</span></span> <span data-ttu-id="fca45-253">Para abrir una ventana de comandos con las credenciales del administrador, haga clic en **Inicio**, haga clic con el botón derecho en **Símbolo del sistema** y, a continuación, haga clic en **Ejecutar como administrador**.</span><span class="sxs-lookup"><span data-stu-id="fca45-253">To open a command window, click **Start**, right-click **Command Prompt**, and then click **Run as administrator**.</span></span>

## <a name="verifying-the-dscp-markings-in-gpo"></a><span data-ttu-id="fca45-254">Verificación de los marcados de DSCP en GPO</span><span class="sxs-lookup"><span data-stu-id="fca45-254">Verifying the DSCP markings in GPO</span></span>

<span data-ttu-id="fca45-255">Para verificar que se hayan establecido los valores del GPO, lleve a cabo estos pasos:</span><span class="sxs-lookup"><span data-stu-id="fca45-255">To verify that the values from the GPO has been set, please perform the following steps:</span></span>

1.  <span data-ttu-id="fca45-256">Use gpresult para verificar que el PC local haya recibido la configuración del GPO.</span><span class="sxs-lookup"><span data-stu-id="fca45-256">Use gpresult to verify that the settings from the GPO has been received by the local PC.</span></span> <span data-ttu-id="fca45-257">gpresult /R >gp.txt generará un informe y lo enviará a un archivo de texto, gp.txt.</span><span class="sxs-lookup"><span data-stu-id="fca45-257">gpresult /R >gp.txt will generate a report and send it to a text file, gp.txt.</span></span>

    ![Captura de pantalla del símbolo del sistema del administrador donde se ejecuta el comando gpresult.](media/Qos-in-Teams-Image3.png)

    <span data-ttu-id="fca45-259">Figura 2: Verificación aplicada a los objetos de directiva de grupo</span><span class="sxs-lookup"><span data-stu-id="fca45-259">Figure 2: Verify Applied Group Policy Objects</span></span>
    > [!NOTE]
    > <span data-ttu-id="fca45-260">Otra opción consiste en ejecutar gpresult /H gp.html para generar los mismos datos en un informe HTML que el usuario entienda con mayor facilidad.</span><span class="sxs-lookup"><span data-stu-id="fca45-260">Alternatively, you can run gpresult /H gp.html to produce the same data in more user-friendly HTML report.</span></span> 
2.  <span data-ttu-id="fca45-261">En el archivo generado, busque el título: Applied Group Policy Objects (Objetos de directiva de grupo aplicados) y compruebe que los nombres de los GPO creados anteriormente están en la lista de directivas aplicadas.</span><span class="sxs-lookup"><span data-stu-id="fca45-261">In the generated file look for the heading: Applied Group Policy Objects and verify that the names of the GPO’s created earlier is in the list of applied policies.</span></span> 

3.  <span data-ttu-id="fca45-262">Abra el editor de registro y acceda a:</span><span class="sxs-lookup"><span data-stu-id="fca45-262">Open the registry editor and navigate to:</span></span>

    <span data-ttu-id="fca45-263">HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\QoS\\</span><span class="sxs-lookup"><span data-stu-id="fca45-263">HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\QoS\\</span></span>

    <span data-ttu-id="fca45-264">Compruebe los valores del registro que aparecen en la tabla 3 siguiente.</span><span class="sxs-lookup"><span data-stu-id="fca45-264">Verify the registry values listed in Table 3 below.</span></span>
    
    | <span data-ttu-id="fca45-265">Nombre</span><span class="sxs-lookup"><span data-stu-id="fca45-265">Name</span></span> | <span data-ttu-id="fca45-266">Tipo</span><span class="sxs-lookup"><span data-stu-id="fca45-266">Type</span></span> | <span data-ttu-id="fca45-267">Datos</span><span class="sxs-lookup"><span data-stu-id="fca45-267">Data</span></span>|
    |---------|---------|---------
    | <span data-ttu-id="fca45-268">Nombre de la aplicación</span><span class="sxs-lookup"><span data-stu-id="fca45-268">Application Name</span></span>|<span data-ttu-id="fca45-269">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="fca45-269">REG_SZ</span></span>|<span data-ttu-id="fca45-270">Teams.exe</span><span class="sxs-lookup"><span data-stu-id="fca45-270">Teams.exe</span></span>|
    | <span data-ttu-id="fca45-271">Valor de DSCP</span><span class="sxs-lookup"><span data-stu-id="fca45-271">DSCP Value</span></span>|<span data-ttu-id="fca45-272">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="fca45-272">REG_SZ</span></span>|<span data-ttu-id="fca45-273">46</span><span class="sxs-lookup"><span data-stu-id="fca45-273">46</span></span>|
    | <span data-ttu-id="fca45-274">IP local</span><span class="sxs-lookup"><span data-stu-id="fca45-274">Second Reflexive Local IP</span></span>|<span data-ttu-id="fca45-275">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="fca45-275">REG_SZ</span></span>|*|
    | <span data-ttu-id="fca45-276">Longitud del prefijo de IP local</span><span class="sxs-lookup"><span data-stu-id="fca45-276">Local IP Prefix Length</span></span>|<span data-ttu-id="fca45-277">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="fca45-277">REG_SZ</span></span>|*|
    | <span data-ttu-id="fca45-278">Puerto local</span><span class="sxs-lookup"><span data-stu-id="fca45-278">Local Port</span></span>|<span data-ttu-id="fca45-279">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="fca45-279">REG_SZ</span></span>|<span data-ttu-id="fca45-280">50000-50019</span><span class="sxs-lookup"><span data-stu-id="fca45-280">50000-50019</span></span>|
    | <span data-ttu-id="fca45-281">Protocolo</span><span class="sxs-lookup"><span data-stu-id="fca45-281">Protocol</span></span>|<span data-ttu-id="fca45-282">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="fca45-282">REG_SZ</span></span>|*|
    | <span data-ttu-id="fca45-283">IP remota</span><span class="sxs-lookup"><span data-stu-id="fca45-283">Remote IP</span></span>|<span data-ttu-id="fca45-284">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="fca45-284">REG_SZ</span></span>|*|
    | <span data-ttu-id="fca45-285">Prefijo de IP remota</span><span class="sxs-lookup"><span data-stu-id="fca45-285">Remote Ip Prefix</span></span>|<span data-ttu-id="fca45-286">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="fca45-286">REG_SZ</span></span>|*|
    | <span data-ttu-id="fca45-287">Puerto remoto</span><span class="sxs-lookup"><span data-stu-id="fca45-287">Remote Port</span></span>|<span data-ttu-id="fca45-288">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="fca45-288">REG_SZ</span></span>|*|
    | <span data-ttu-id="fca45-289">Velocidad de limitación</span><span class="sxs-lookup"><span data-stu-id="fca45-289">Throttle Rate</span></span>|<span data-ttu-id="fca45-290">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="fca45-290">REG_SZ</span></span>|<span data-ttu-id="fca45-291">-1</span><span class="sxs-lookup"><span data-stu-id="fca45-291">$1</span></span>|
    
    <span data-ttu-id="fca45-292">Tabla 3: Valores del Registro de Windows para QoS</span><span class="sxs-lookup"><span data-stu-id="fca45-292">Table 3: Windows registry values for QoS</span></span>

4.  <span data-ttu-id="fca45-293">Compruebe que el nombre de la aplicación sea correcto para el cliente que está usando y compruebe que el valor de DSCP y el del puerto local reflejan la configuración del GPO.</span><span class="sxs-lookup"><span data-stu-id="fca45-293">Verify that the Application Name is correct for the client you are using, and verify that both DSCP value and Local Port reflect the settings in the GPO.</span></span>

## <a name="validating-qos-analyzing-teams-traffic-on-the-network"></a><span data-ttu-id="fca45-294">Validación de QoS: análisis del tráfico de Teams en la red</span><span class="sxs-lookup"><span data-stu-id="fca45-294">Validating QoS: Analyzing Teams traffic on the network</span></span>

<span data-ttu-id="fca45-295">El valor de DSCP que establece el GPO tiene que estar presente desde la persona que llama al destinatario para que QoS sea eficaz.</span><span class="sxs-lookup"><span data-stu-id="fca45-295">The DSCP value set by the GPO needs to be present from caller to callee in order for QoS to be affective.</span></span> <span data-ttu-id="fca45-296">Si nos fijamos en el tráfico que genera el cliente de Teams, podemos verificar que el DSCP no ha cambiado ni se ha seccionado al atravesar la red.</span><span class="sxs-lookup"><span data-stu-id="fca45-296">By looking at the traffic generated by the Teams client we can verify that the DSCP is not changed or stripped out when traversing the network.</span></span> 

<span data-ttu-id="fca45-297">Preferiblemente, capturaríamos el tráfico en el punto de entrada de la red.</span><span class="sxs-lookup"><span data-stu-id="fca45-297">Preferably we would capture traffic at the network egress point.</span></span> <span data-ttu-id="fca45-298">La creación de reflejos del puerto se puede usar en un conmutador o un enrutador para ayudar a capturar el tráfico en la red.</span><span class="sxs-lookup"><span data-stu-id="fca45-298">Port mirroring can be used on a switch or router to aid in capturing traffic on the network.</span></span> 

### <a name="looking-at-network-traffic-using-network-monitor"></a><span data-ttu-id="fca45-299">Verificación del tráfico de red con Monitor de red</span><span class="sxs-lookup"><span data-stu-id="fca45-299">Looking at network traffic using Network Monitor</span></span>

<span data-ttu-id="fca45-300">Monitor de red es una herramienta que puede descargarse desde Microsoft para analizar el tráfico de red.</span><span class="sxs-lookup"><span data-stu-id="fca45-300">Network Monitor is a tool you can download from Microsoft to analyze network traffic.</span></span> <span data-ttu-id="fca45-301">Descargue [Monitor de red 3.4](https://www.microsoft.com/download/4865).</span><span class="sxs-lookup"><span data-stu-id="fca45-301">Download [Network Monitor 3.4](https://www.microsoft.com/download/4865).</span></span>

<span data-ttu-id="fca45-302">Conecte el PC que ejecuta Monitor de red al puerto que se ha configurado para la creación de reflejos de puertos y comience a capturar paquetes.</span><span class="sxs-lookup"><span data-stu-id="fca45-302">Connect to PC running network monitor to the port that has been configured for port mirroring and start capturing packets.</span></span> <span data-ttu-id="fca45-303">Haga una llamada con el cliente de Skype Empresarial.</span><span class="sxs-lookup"><span data-stu-id="fca45-303">Make a call using the Skype for Business client.</span></span> <span data-ttu-id="fca45-304">Asegúrese de que los medios se han establecido antes de colgar la llamada.</span><span class="sxs-lookup"><span data-stu-id="fca45-304">Make sure media is established before hanging up the call.</span></span> <span data-ttu-id="fca45-305">Al detener la captura, se crea un filtro de visualización que coincide con el IP de origen del PC que hizo la llamada y se restringe el filtro definiendo el valor de DSCP 46 (hex 0xb8) como criterio de búsqueda:</span><span class="sxs-lookup"><span data-stu-id="fca45-305">Stop the capture create a Display Filter that matches the source IP of the PC that made the call and refine the filter by defining DSCP value 46 (hex 0xb8) as search criteria:</span></span>

<span data-ttu-id="fca45-306">Source == "192.168.137.201" AND IPv4.DifferentiatedServicesField == 0xb8</span><span class="sxs-lookup"><span data-stu-id="fca45-306">Source == "192.168.137.201" AND IPv4.DifferentiatedServicesField == 0xb8</span></span> 

![Captura del cuadro de diálogo de visualización del filtro en Monitor de red, donde se muestran los filtros que se van a aplicar.](media/Qos-in-Teams-Image4.png)


<span data-ttu-id="fca45-308">Haga clic en **Aplicar** para activar el filtro.</span><span class="sxs-lookup"><span data-stu-id="fca45-308">Click **Apply** to activate the filter.</span></span> <span data-ttu-id="fca45-309">En la ventana de **resumen del marco**, seleccione el primer paquete UDP y fíjese en los detalles del marco:</span><span class="sxs-lookup"><span data-stu-id="fca45-309">In the **Frame Summary** window, select the first UDP packet and look at the Frame Details:</span></span>

![Captura de pantalla del cuadro de diálogo de detalles del marco en Monitor de red, donde se resalta la configuración de DSCP.](media/Qos-in-Teams-Image5.png)

<span data-ttu-id="fca45-311">Amplíe IPv4 y fíjese en el valor que hay al final de la línea de DSCP.</span><span class="sxs-lookup"><span data-stu-id="fca45-311">Expand IPv4 and look at the value at the end of the DSCP line.</span></span> <span data-ttu-id="fca45-312">En este ejemplo se ve que el valor de DSCP está configurado en 46, lo cual es correcto puesto que el puerto de origen usado es 50019, lo que nos indica que la carga de trabajo es de voz.</span><span class="sxs-lookup"><span data-stu-id="fca45-312">In this example we see that the DSCP value is set to 46 which is correct since the source port used is 50019 which tells us that the workload is voice.</span></span> 

<span data-ttu-id="fca45-313">Repita la verificación para cada carga de trabajo que marque el GPO.</span><span class="sxs-lookup"><span data-stu-id="fca45-313">Repeat the verification for each workload that has been marked by the GPO.</span></span> 

> [!NOTE]
> <span data-ttu-id="fca45-314">Compruebe que los marcados atiendan al tráfico punto a punto también.</span><span class="sxs-lookup"><span data-stu-id="fca45-314">Verify that markings are honored for peer-to-peer traffic as well.</span></span> <span data-ttu-id="fca45-315">Esto se puede lograr si instala Monitor de red en dos clientes y realiza llamadas entre los dos clientes.</span><span class="sxs-lookup"><span data-stu-id="fca45-315">This can be done by installing Network Monitor on two clients and placing calls between the two clients.</span></span> <span data-ttu-id="fca45-316">Fíjese en el tráfico de medios que fluye entre los clientes como se ha descrito anteriormente.</span><span class="sxs-lookup"><span data-stu-id="fca45-316">Look at the media traffic flowing between clients in the same manner as described above.</span></span>

### <a name="sample-filters-to-use-for-network-monitor-or-wireshark"></a><span data-ttu-id="fca45-317">Ejemplo de filtros que se deben usar para Monitor de red o Wireshark</span><span class="sxs-lookup"><span data-stu-id="fca45-317">Sample filters to use for Network Monitor or Wireshark</span></span>

|<span data-ttu-id="fca45-318">Uso</span><span class="sxs-lookup"><span data-stu-id="fca45-318">Usage</span></span>  |<span data-ttu-id="fca45-319">Ejemplo de filtro</span><span class="sxs-lookup"><span data-stu-id="fca45-319">Sample filter</span></span>  |
|---------|---------|
|<span data-ttu-id="fca45-320">Voz (nota: hay que desactivar la multiplexación)</span><span class="sxs-lookup"><span data-stu-id="fca45-320">Voice (note: muxing must be turned off)</span></span>     |   <span data-ttu-id="fca45-321">udp.port==3479 AND Ipv4.DifferentiatedServicesField.DSCP==46</span><span class="sxs-lookup"><span data-stu-id="fca45-321">udp.port==3479 AND Ipv4.DifferentiatedServicesField.DSCP==46</span></span>      |
|<span data-ttu-id="fca45-322">Vídeo</span><span class="sxs-lookup"><span data-stu-id="fca45-322">Video</span></span>     | <span data-ttu-id="fca45-323">udp.port==3480 AND Ipv4.DifferentiatedServicesField.DSCP==34</span><span class="sxs-lookup"><span data-stu-id="fca45-323">udp.port==3480 AND Ipv4.DifferentiatedServicesField.DSCP==34</span></span>        |
|<span data-ttu-id="fca45-324">Pantalla compartida</span><span class="sxs-lookup"><span data-stu-id="fca45-324">Screen sharing</span></span>     |  <span data-ttu-id="fca45-325">udp.port==3481 AND Ipv4.DifferentiatedServicesField.DSCP==18</span><span class="sxs-lookup"><span data-stu-id="fca45-325">udp.port==3481 AND Ipv4.DifferentiatedServicesField.DSCP==18</span></span>       |

### <a name="filter-media-traffic-from-microsoft-relays-requires-azure-expressroutehttpsazuremicrosoftcomservicesexpressroute"></a><span data-ttu-id="fca45-326">Filtro: tráfico de medios desde relés de Microsoft (requiere [Azure ExpressRoute](https://azure.microsoft.com/services/expressroute/))</span><span class="sxs-lookup"><span data-stu-id="fca45-326">Filter: Media traffic from Microsoft relays (requires [Azure ExpressRoute](https://azure.microsoft.com/services/expressroute/))</span></span>

<span data-ttu-id="fca45-327">ip.src in {52.114.188.0/22 52.114.220.0/22 52.114.124.0/22 52.114.60.0/22} y (udp.srcport in {3479 3480 3481} o (udp.srcport ge 50000 y udp.srcport lt 60000))</span><span class="sxs-lookup"><span data-stu-id="fca45-327">ip.src in {52.114.188.0/22 52.114.220.0/22 52.114.124.0/22 52.114.60.0/22} and (udp.srcport in {3479 3480 3481} or (udp.srcport ge 50000 and udp.srcport lt 60000))</span></span>

### <a name="filter-media-traffic-to-microsoft-relays"></a><span data-ttu-id="fca45-328">Filtro: tráfico de medios a relés de Microsoft</span><span class="sxs-lookup"><span data-stu-id="fca45-328">Filter: Media traffic to Microsoft relays</span></span>

<span data-ttu-id="fca45-329">ip.dst in {52.114.188.0/22 52.114.220.0/22 52.114.124.0/22 52.114.60.0/22} y (udp.dstport en {3479 3480 3481} o (udp.dstport ge 50000 y udp.dstport lt 60000))</span><span class="sxs-lookup"><span data-stu-id="fca45-329">ip.dst in {52.114.188.0/22 52.114.220.0/22 52.114.124.0/22 52.114.60.0/22} and (udp.dstport in {3479 3480 3481} or (udp.dstport ge 50000 and udp.dstport lt 60000))</span></span>


<span data-ttu-id="fca45-330">Debe consultar el tráfico que se dirige a los relés de Microsoft y que procede de ellos.</span><span class="sxs-lookup"><span data-stu-id="fca45-330">You should see traffic to and from the Microsoft relays.</span></span> <span data-ttu-id="fca45-331">Puede comprobar los marcados de DSCP en la capa de IP en Wireshark, como se muestra en la próxima sección.</span><span class="sxs-lookup"><span data-stu-id="fca45-331">You can check DSCP markings on the IP layer in Wireshark, as shown in the next section.</span></span>

### <a name="expected-dscp-markings"></a><span data-ttu-id="fca45-332">Marcados DSCP esperados</span><span class="sxs-lookup"><span data-stu-id="fca45-332">Expected DSCP markings</span></span>

<span data-ttu-id="fca45-333">Transmisiones de audio: 46</span><span class="sxs-lookup"><span data-stu-id="fca45-333">Audio streams: 46</span></span>

<span data-ttu-id="fca45-334">Transmisiones de vídeo: 34</span><span class="sxs-lookup"><span data-stu-id="fca45-334">Video streams: 34</span></span>

<span data-ttu-id="fca45-335">Transmisiones de datos: 18</span><span class="sxs-lookup"><span data-stu-id="fca45-335">Data streams: 18</span></span>

### <a name="filter-dscp-condition-to-network"></a><span data-ttu-id="fca45-336">Filtro: condición de DSCP a la red</span><span class="sxs-lookup"><span data-stu-id="fca45-336">Filter: DSCP condition to network</span></span>

<span data-ttu-id="fca45-337">ip.dsfield.dscp in {46 34 18}</span><span class="sxs-lookup"><span data-stu-id="fca45-337">ip.dsfield.dscp in {46 34 18}</span></span>



### <a name="looking-at-network-traffic-using-wireshark"></a><span data-ttu-id="fca45-338">Verificación del tráfico de red con Wireshark</span><span class="sxs-lookup"><span data-stu-id="fca45-338">Looking at network traffic using Wireshark</span></span>

<span data-ttu-id="fca45-339">Wireshark, https://www.wireshark.org/, es una potente herramienta que nos permite filtrar y registrar los datos de red para poder analizarlos después.</span><span class="sxs-lookup"><span data-stu-id="fca45-339">Wireshark, https://www.wireshark.org/, is a powerful tool that allows us to filter and record network data for further analysis.</span></span> <span data-ttu-id="fca45-340">Conecte un PC que ejecute Wireshark al puerto que se ha configurado para la creación de reflejos de puertos y comience a capturar paquetes.</span><span class="sxs-lookup"><span data-stu-id="fca45-340">Connect a PC running Wireshark to the port that has been configured for port mirroring and start capturing packets.</span></span> <span data-ttu-id="fca45-341">Haga una llamada con el cliente de Teams.</span><span class="sxs-lookup"><span data-stu-id="fca45-341">Make a call using the Teams client.</span></span> <span data-ttu-id="fca45-342">Asegúrese de que los medios se han establecido antes de colgar la llamada.</span><span class="sxs-lookup"><span data-stu-id="fca45-342">Make sure media is established before hanging up the call.</span></span>

<span data-ttu-id="fca45-343">Detenga el seguimiento del paquete y cree un filtro que solo muestre la IP de origen del PC en el que el cliente de Teams está instalado; por ejemplo, *ip.src_host == 192.168.137.201*, y busque paquetes que usen un puerto de origen del intervalo especificado para la voz: 50 000 – 50 019:</span><span class="sxs-lookup"><span data-stu-id="fca45-343">Stop the packet trace and create a filter that only displays the source IP of the PC where the Teams client is installed, for example, *ip.src_host == 192.168.137.201* and looks for packages that use a source port from the range specified for voice, 50,000 – 50,019:</span></span>

![Captura de pantalla de Wireshark con la configuración del filtro.](media/Qos-in-Teams-Image6.png)
 

<span data-ttu-id="fca45-345">Marque el paquete y expanda el encabezado del protocolo de Internet versión 4 (IPV4) en el panel de detalles del paquete:</span><span class="sxs-lookup"><span data-stu-id="fca45-345">Mark the package and expand the Internet Protocol Version 4 (IPV4) header in the packet detail pane:</span></span>

![Captura de pantalla de Wireshark con la configuración de marcados de punto de código de servicios diferenciados resaltada.](media/Qos-in-Teams-Image7.png)
 

<span data-ttu-id="fca45-347">Compruebe que el valor del *punto de código de servicios diferenciados* coincide con el valor de la carga de trabajo especificada que, en este caso, es 46 (101110 binario) para la voz.</span><span class="sxs-lookup"><span data-stu-id="fca45-347">Verify that the value for *Differentiated Services Codepoint* match the value for the specific workload, in this case 46 (binary 101110) for voice.</span></span>

<span data-ttu-id="fca45-348">Repita la verificación para cada carga de trabajo que marque el GPO.</span><span class="sxs-lookup"><span data-stu-id="fca45-348">Repeat the verification for each workload that has been marked by the GPO.</span></span>

> [!NOTE]
> <span data-ttu-id="fca45-349">Compruebe que los marcados atiendan al tráfico punto a punto.</span><span class="sxs-lookup"><span data-stu-id="fca45-349">Verify that markings are honored for peer-to-peer traffic.</span></span> <span data-ttu-id="fca45-350">Esto se puede lograr si instala WireShark o Monitor de red en dos clientes y realiza llamadas entre los dos clientes.</span><span class="sxs-lookup"><span data-stu-id="fca45-350">This can be done by installing WireShark or Network Monitor on two clients and placing calls between the two clients.</span></span> <span data-ttu-id="fca45-351">Fíjese en el tráfico de medios que fluye entre los clientes como se ha descrito anteriormente.</span><span class="sxs-lookup"><span data-stu-id="fca45-351">Look at the media traffic flowing between clients in the same manner as described above.</span></span>

## <a name="summary"></a><span data-ttu-id="fca45-352">Resumen</span><span class="sxs-lookup"><span data-stu-id="fca45-352">Summary</span></span>

<span data-ttu-id="fca45-353">Calidad de servicio es una pieza fundamental del puzle que se crea cuando se quieren proporcionar experiencias de tipo empresarial con Teams.</span><span class="sxs-lookup"><span data-stu-id="fca45-353">Quality of Service is an important piece of the puzzle when providing business-class experiences with Teams.</span></span> <span data-ttu-id="fca45-354">Sin embargo, también es fundamental recordar que QoS solo es eficaz en redes administradas correctamente.</span><span class="sxs-lookup"><span data-stu-id="fca45-354">However, it is important to always remember that QoS is only effective on properly managed networks.</span></span> <span data-ttu-id="fca45-355">De ese modo, el equipo de implementación debe trabajar mano a mano con los equipos de redes y, así, garantizar que la información adecuada pasa a la capa de red, idealmente administrada de un extremo a otro.</span><span class="sxs-lookup"><span data-stu-id="fca45-355">As such, the deployment team must work very closely with the networking teams to ensure the proper information is passed at the network layer, ideally managed from end-to-end.</span></span>

